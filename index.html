<script>
    const animationDuration = 800; // Varighet for animasjoner i millisekunder
    const attackLock = {}; // Hindrer at angrep skjer før forrige animasjon er ferdig

    function replaceSprite(player, action, callback) {
        if (!player || !player.img) return; // Sikrer at spiller og bilde er initialisert
        const originalSrc = player.img.src;
        const actionSrc = originalSrc.replace(/(\\w+)\\.png$/, `${action}$1.png`); // Dynamisk sprite-bytting

        // Bytt til angrepssprite
        player.img.src = actionSrc;

        setTimeout(() => {
            // Tilbakestill til original sprite
            player.img.src = originalSrc;
            if (callback) callback();
        }, animationDuration);
    }

    window.addEventListener('keydown', e => {
        const key = e.key.toLowerCase();

        // Player 1 angrep
        if (key === 'q' && !attackLock['q']) {
            attackLock['q'] = true;
            replaceSprite(player1, 'punch', () => {
                applyKnockback(player2, punchDamage, player2.damage);
                attackLock['q'] = false;
            });
        } else if (key === 'e' && !attackLock['e']) {
            attackLock['e'] = true;
            replaceSprite(player1, 'kick', () => {
                applyKnockback(player2, kickDamage, player2.damage);
                attackLock['e'] = false;
            });
        }

        // Player 2 angrep
        if (key === 'm' && !attackLock['m']) {
            attackLock['m'] = true;
            replaceSprite(player2, 'punch', () => {
                applyKnockback(player1, punchDamage, player1.damage);
                attackLock['m'] = false;
            });
        } else if (key === 'n' && !attackLock['n']) {
            attackLock['n'] = true;
            replaceSprite(player2, 'kick', () => {
                applyKnockback(player1, kickDamage, player1.damage);
                attackLock['n'] = false;
            });
        }
    });

    // Sikrer at spillere blir tegnet på riktig måte
    function drawPlayer(player) {
        if (player && player.img.complete) {
            ctx.drawImage(player.img, player.x, player.y, player.width, player.height);
        }
    }
</script>
